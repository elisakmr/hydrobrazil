---
title: "Land use proportion"
output: html_document
---

## Directories

```{r }


if ((Sys.info()["nodename"]) == "COP026") {
  dir_data <- "C:/Users/arvor_d/Documents/workwork/data"
  dir_plot <- "C:/Users/arvor_d/Documents/workwork/plot"
} else if ((Sys.info()["nodename"]) == "COSTELSV6") {
  dir_data <- "F:/kamir_e/$data"
  dir_plot <- "F:/kamir_e/$plot "
}

```

## Library

```{r }

library(plyr)
library(dplyr)
library(foreach)
library(iterators)
library(parallel)
library(doParallel)
library(maps)
library(nnet)
library(latticeExtra)
library(sp)
library(rgdal)
library(raster)
library(sf)
library(stars)
library(exactextractr)
library(tictoc)
library(terra)


```

## Computing mapbiomas land coverage percent at hydrobasin level

1. on one year only for now
2. loop on hydrobasin polygon


```{r }

### LOADING PRE PROCESSED DATA

# land use from mapbiomas
biomas85_19_mt <- rast(file.path(dir_data, "processed", "biomas1985_2019_mg.tif"))

# hydrobasins from hydroshed on utm projection

hydrobasin <- st_read(file.path(dir_data, "hydroshed","hydrobasins_level9", "hydrobasin_mg_lev9.shp"))

## EXTRACTING LAND USE FOR EACH POLYGON AND SAVING LIST OF DF

tic()
basin_extract(biomas85_19_mt, hydrobasin)
toc()

# tic()
# basin_extract_parallel(biomas85_19_mt[[1]], hydrobasin[1:16,])
# toc()

```



