---
title: "Plot vulnerability features"
output: html_document
---

## Directories

```{r }

if ((Sys.info()["nodename"]) == "COP026") {
  dir_data <- "C:/Users/arvor_d/Documents/workwork/data"
  dir_plot <- "C:/Users/arvor_d/Documents/workwork/plot"
} else if ((Sys.info()["nodename"]) == "COSTELSV6") {
  dir_data <- "F:/kamir_e/$data"
  dir_plot <- "F:/kamir_e/$plot "
}

```

## Library

```{r }

library(plyr)
library(tidyverse)
library(tidyr)
library(dplyr)
library(foreach)
library(iterators)
library(lwgeom)
library(parallel)
library(doParallel)
library(maps)
library(nnet)
library(ggplot2)
library(latticeExtra)
library(sp)
library(rgdal)
library(raster)
library(stringi)
library(ggmap)
library(sf)
library(viridis)

```

## BUILDING DATA FRAME  

```{r }

### year 2012 et 2015
### 4 poly

                                  ############################# PARAMETERS  ###############################
time_span <- c(2000:2017)
time_span[c(seq(1,18,3),18)]
load(file = file.path(dir_data, "vulnerability", "1000randomid.RData"))

poly_id<-c(6090574580,6090609510,6090653660,6090630220)
year_select <- '2012'
x <- 'soy'
y='foret'
basin_id

                                  ############################# FUNCTION  ###############################

abscisse <- "cotton_fallow"
ordonnee <- "past_mo"

sf_list_name <- list.files(path=file.path(dir_data, "vulnerability"), pattern = paste0(year_select,".+.shp"), full.names = TRUE)
sf_list_files <- lapply(sf_list_name, st_read)

df_result <- data.frame(polyid= unlist(lapply(sf_list_files, '[[', "HYBAS_I")),
                        past_ma= unlist(lapply(sf_list_files, '[[', abscisse)),
                        for_up=unlist(lapply(sf_list_files, '[[', ordonnee)))

ggplot(df_result) + geom_point(aes(x=past_ma, y=for_up), color=factor(df_result$polyid), show.legend = TRUE) + theme_classic() + scale_color_viridis()

unlist(lapply(sf_list_files, '[[', ordonnee))[which(unlist(lapply(sf_list_files, '[[', ordonnee))>=1)]
sf_list_name[493]
```









